# PDFæ¨¡æ¿æ–¹æ¡ˆä½¿ç”¨æŒ‡å—

## ä»€ä¹ˆæ˜¯PDFæ¨¡æ¿æ–¹æ¡ˆï¼Ÿ

PDFæ¨¡æ¿æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ1ï¼‰æ˜¯ä¸€ç§å°†**è®¾è®¡å¥½çš„PDF/å›¾ç‰‡æ¨¡æ¿**ä¸**åŠ¨æ€æ•°æ®**ç»“åˆçš„PDFç”Ÿæˆæ–¹æ³•ã€‚

### æ ¸å¿ƒæ€è·¯

1. **åˆ¶ä½œæ¨¡æ¿**ï¼šå…ˆè®¾è®¡ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¸ƒå±€ã€è¾¹æ¡†ã€æ ‡ç­¾çš„æ¨¡æ¿æ–‡ä»¶
2. **å®šä½åæ ‡**ï¼šç¡®å®šæ¯ä¸ªæ•°æ®å­—æ®µåœ¨æ¨¡æ¿ä¸Šçš„ç²¾ç¡®ä½ç½®ï¼ˆX, Yåæ ‡ï¼‰
3. **å¡«å……æ•°æ®**ï¼šä½¿ç”¨pdf-libåº“åœ¨è¿™äº›åæ ‡ä½ç½®ä¸Šç»˜åˆ¶æ–‡æœ¬

### ä¼˜åŠ¿

- âœ… **æ ·å¼ç²¾å‡†**ï¼šå®Œå…¨æŒ‰ç…§è®¾è®¡ç¨¿å±•ç¤ºï¼Œæ‰€è§å³æ‰€å¾—
- âœ… **æ˜“äºè°ƒæ•´**ï¼šä¿®æ”¹æ¨¡æ¿ä¸éœ€è¦æ”¹ä»£ç ï¼Œåªéœ€æ›¿æ¢å›¾ç‰‡
- âœ… **é€‚åˆå¤æ‚å¸ƒå±€**ï¼šè¡¨æ ¼ã€è¾¹æ¡†ã€å›¾ç‰‡ç­‰å¤æ‚å…ƒç´ é€šè¿‡æ¨¡æ¿è½»æ¾å®ç°

### åŠ£åŠ¿

- âŒ **åæ ‡å®šä½**ï¼šéœ€è¦æ‰‹åŠ¨æµ‹é‡å’Œè°ƒæ•´æ¯ä¸ªå­—æ®µçš„åæ ‡
- âŒ **çµæ´»æ€§**ï¼šåŠ¨æ€å†…å®¹ï¼ˆå¦‚å¯å˜è¡Œæ•°ï¼‰å¤„ç†è¾ƒå¤æ‚

---

## åˆ¶ä½œPDFæ¨¡æ¿çš„4ç§æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨ç°æœ‰å›¾ç‰‡ï¼ˆæœ€å¿«é€Ÿï¼Œå·²å®ç°âœ…ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå·²ç»æœ‰æŠ¥é”€å•çš„æˆªå›¾ã€æ‰«æä»¶æˆ–è®¾è®¡ç¨¿

**æ­¥éª¤**ï¼š
1. å‡†å¤‡å›¾ç‰‡æ–‡ä»¶ï¼ˆPNGã€JPGç­‰ï¼‰
2. å°†å›¾ç‰‡æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œå‘½åä¸º `template.png`
3. è¿è¡Œåæ ‡è¾…åŠ©å·¥å…·ï¼š
   ```bash
   node find-coordinates.js
   ```
4. æ‰“å¼€ç”Ÿæˆçš„ `template-with-grid.pdf`ï¼ŒæŸ¥çœ‹ç½‘æ ¼å’Œåæ ‡
5. æ ¹æ®åæ ‡ä¿®æ”¹ `generate-receipt-template.js` ä¸­çš„åæ ‡å€¼

### æ–¹æ³•2ï¼šä½¿ç”¨LibreOffice Drawï¼ˆå…è´¹æ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šä»é›¶è®¾è®¡æ–°æ¨¡æ¿

**æ­¥éª¤**ï¼š
1. æ‰“å¼€ LibreOffice Draw
2. åˆ›å»ºæ–°æ–‡æ¡£ï¼Œè®¾ç½®é¡µé¢å¤§å°ï¼ˆæ–‡ä»¶ â†’ é¡µé¢ â†’ æ ¼å¼ï¼‰
3. ä½¿ç”¨ç»˜å›¾å·¥å…·è®¾è®¡å¸ƒå±€ï¼š
   - æ’å…¥ â†’ è¡¨æ ¼ï¼ˆåˆ›å»ºè¡¨æ ¼ï¼‰
   - æ’å…¥ â†’ æ–‡æœ¬æ¡†ï¼ˆæ·»åŠ æ ‡ç­¾ï¼‰
   - æ’å…¥ â†’ å½¢çŠ¶ï¼ˆæ·»åŠ è¾¹æ¡†ã€çº¿æ¡ï¼‰
4. **åªè®¾è®¡å¸ƒå±€å’Œæ ‡ç­¾ï¼Œä¸å¡«å†™å…·ä½“æ•°æ®**
5. å¯¼å‡ºä¸ºPDFæˆ–PNGï¼šæ–‡ä»¶ â†’ å¯¼å‡ºä¸ºPDF/PNG
6. å°†å¯¼å‡ºçš„æ–‡ä»¶ä½œä¸ºæ¨¡æ¿ä½¿ç”¨

### æ–¹æ³•3ï¼šä½¿ç”¨Adobe Acrobatè¡¨å•ï¼ˆä¸“ä¸šæ–¹æ¡ˆï¼Œä»˜è´¹ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦è¡¨å•å­—æ®µåŠŸèƒ½ï¼Œæˆ–ä¸“ä¸šPDFå¤„ç†

**æ­¥éª¤**ï¼š
1. åœ¨Acrobatä¸­æ‰“å¼€æˆ–åˆ›å»ºPDF
2. å·¥å…· â†’ å‡†å¤‡è¡¨å•
3. æ·»åŠ è¡¨å•å­—æ®µå¹¶å‘½åï¼ˆå¦‚ "name", "amount" ç­‰ï¼‰
4. ä¿å­˜PDF

**ä»£ç ä½¿ç”¨æ–¹å¼**ï¼ˆéœ€è¦é¢å¤–å®ç°ï¼‰ï¼š
```javascript
const form = pdfDoc.getForm();
const nameField = form.getTextField('name');
nameField.setText('å¼ ä¸‰');
```

### æ–¹æ³•4ï¼šä½¿ç”¨åœ¨çº¿è®¾è®¡å·¥å…·

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦ä¸“ä¸šè®¾è®¡ä½†æ²¡æœ‰è®¾è®¡è½¯ä»¶

**æ¨èå·¥å…·**ï¼š
- Canvaï¼ˆhttps://www.canva.comï¼‰
- Figmaï¼ˆhttps://www.figma.comï¼‰
- Google Slides

**æ­¥éª¤**ï¼š
1. åœ¨å·¥å…·ä¸­è®¾è®¡æ¨¡æ¿
2. å¯¼å‡ºä¸ºPNGæˆ–PDF
3. ä½¿ç”¨å¯¼å‡ºçš„æ–‡ä»¶ä½œä¸ºæ¨¡æ¿

---

## ä½¿ç”¨æœ¬é¡¹ç›®çš„æ¨¡æ¿å·¥å…·

### 1. æŸ¥æ‰¾åæ ‡ï¼ˆfind-coordinates.jsï¼‰

ç”Ÿæˆä¸€ä¸ªå¸¦ç½‘æ ¼çš„PDFï¼Œå¸®åŠ©ä½ ç¡®å®šæ–‡æœ¬ä½ç½®ï¼š

```bash
node find-coordinates.js
```

**è¾“å‡º**ï¼š`template-with-grid.pdf`

**è¯´æ˜**ï¼š
- çº¢è‰²ç½‘æ ¼ï¼šç²—çº¿é—´éš”100åƒç´ ï¼Œç»†çº¿é—´éš”50åƒç´ 
- åæ ‡ç³»ç»Ÿï¼šåŸç‚¹(0,0)åœ¨å·¦ä¸‹è§’ï¼ŒXè½´å‘å³ï¼ŒYè½´å‘ä¸Š
- ä»é¡¶éƒ¨è®¡ç®—Yåæ ‡ï¼š`y = å›¾ç‰‡é«˜åº¦ - è·é¡¶éƒ¨è·ç¦»`

### 2. åŸºäºæ¨¡æ¿ç”ŸæˆPDFï¼ˆgenerate-receipt-template.jsï¼‰

ä½¿ç”¨æ¨¡æ¿å’Œæ•°æ®ç”Ÿæˆæœ€ç»ˆPDFï¼š

```bash
node generate-receipt-template.js [è¾“å‡ºæ–‡ä»¶å]
```

**ç¤ºä¾‹**ï¼š
```bash
node generate-receipt-template.js my-receipt.pdf
```

**åœ¨ä»£ç ä¸­ä½¿ç”¨**ï¼š
```javascript
const { generateReceiptFromTemplate } = require('./generate-receipt-template');

const data = {
  date: '2025å¹´07æœˆ28æ—¥',
  department: 'ç»è¥è®¡åˆ’å®¤',
  totalAmount: '99.00',
  traveler: 'è°¢æ¾',
  reason: 'å‡ºå·®',
  trips: [
    {
      departDate: '2025-07-29',
      departPlace: 'åŒ—äº¬',
      arriveDate: '2025-07-30',
      arrivePlace: 'ä¸Šæµ·',
      transport: 'é«˜é“',
      transportFee: '99.00',
      // ... æ›´å¤šå­—æ®µ
    }
  ],
  // ... æ›´å¤šå­—æ®µ
};

await generateReceiptFromTemplate(data, 'output.pdf');
```

---

## è°ƒæ•´åæ ‡çš„æŠ€å·§

### ç†è§£PDFåæ ‡ç³»

PDFä½¿ç”¨çš„æ˜¯æ•°å­¦åæ ‡ç³»ï¼ˆä¸ç½‘é¡µCSSä¸åŒï¼‰ï¼š

```
          Yè½´ â†‘
              |
              |
    (100,400) |
              |
  â†-----------+----------â†’ Xè½´
 (0,0)        |
```

- **åŸç‚¹(0,0)**ï¼šå·¦ä¸‹è§’
- **Xè½´**ï¼šä»å·¦åˆ°å³é€’å¢
- **Yè½´**ï¼šä»ä¸‹åˆ°ä¸Šé€’å¢

### å¸¸ç”¨åæ ‡è®¡ç®—

```javascript
// æ¨¡æ¿å›¾ç‰‡é«˜åº¦
const imgHeight = 535;  // ä» find-coordinates.js è¾“å‡ºè·å–

// 1. è·ç¦»é¡¶éƒ¨çš„ä½ç½®
const yè·é¡¶60 = imgHeight - 60;  // è·é¡¶éƒ¨60åƒç´ 

// 2. è·ç¦»åº•éƒ¨çš„ä½ç½®
const yè·åº•100 = 100;  // è·åº•éƒ¨100åƒç´ 

// 3. å±…ä¸­ä½ç½®ï¼ˆXè½´ï¼‰
const imgWidth = 910;
const xCenter = imgWidth / 2;
```

### å¾®è°ƒåæ ‡

1. è¿è¡Œç”Ÿæˆè„šæœ¬æŸ¥çœ‹æ•ˆæœ
2. å¦‚æœæ–‡æœ¬ä½ç½®ä¸å¯¹ï¼Œå¾®è°ƒåæ ‡ï¼š
   - å‘å³ç§»åŠ¨ï¼šå¢å¤§ X å€¼
   - å‘å·¦ç§»åŠ¨ï¼šå‡å° X å€¼
   - å‘ä¸Šç§»åŠ¨ï¼šå¢å¤§ Y å€¼ï¼ˆæ³¨æ„ï¼šå‘ä¸Šæ˜¯å¢å¤§ï¼ï¼‰
   - å‘ä¸‹ç§»åŠ¨ï¼šå‡å° Y å€¼
3. é‡æ–°è¿è¡Œç”Ÿæˆè„šæœ¬éªŒè¯

### æ‰¹é‡è°ƒæ•´æŠ€å·§

åœ¨ `generate-receipt-template.js` ä¸­ä½¿ç”¨å˜é‡ï¼š

```javascript
// å®šä¹‰åŸºå‡†çº¿
const headerY = imgHeight - 135;
const firstRowY = imgHeight - 200;
const rowHeight = 30;

// ä½¿ç”¨åŸºå‡†çº¿
drawText(data.traveler, 100, headerY);  // è¡¨å¤´
drawText(trip1.date, 40, firstRowY);    // ç¬¬1è¡Œ
drawText(trip2.date, 40, firstRowY - rowHeight);  // ç¬¬2è¡Œ
drawText(trip3.date, 40, firstRowY - rowHeight * 2);  // ç¬¬3è¡Œ
```

---

## å®Œæ•´å·¥ä½œæµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆè®¾ç½®æ¨¡æ¿ï¼‰

```bash
# 1. å‡†å¤‡æ¨¡æ¿å›¾ç‰‡
# å°† template.png æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•

# 2. ç”Ÿæˆå¸¦ç½‘æ ¼çš„å‚è€ƒPDF
node find-coordinates.js

# 3. æ‰“å¼€ template-with-grid.pdfï¼Œè®°å½•åæ ‡
# ä¾‹å¦‚ï¼šå§“åå­—æ®µåœ¨ (100, 400)

# 4. ä¿®æ”¹ generate-receipt-template.js
# æ‰¾åˆ° drawText å‡½æ•°è°ƒç”¨ï¼Œæ›´æ–°åæ ‡
# drawText(data.traveler, 100, 400);

# 5. æµ‹è¯•ç”Ÿæˆ
node generate-receipt-template.js test.pdf

# 6. æŸ¥çœ‹ test.pdfï¼Œå¦‚éœ€è¦åˆ™è¿”å›æ­¥éª¤4å¾®è°ƒ
```

### æ—¥å¸¸ä½¿ç”¨ï¼ˆæ•°æ®ç”Ÿæˆï¼‰

```bash
# ç›´æ¥è¿è¡Œç”Ÿæˆ
node generate-receipt-template.js output.pdf

# æˆ–åœ¨ä»£ç ä¸­è°ƒç”¨
const { generateReceiptFromTemplate } = require('./generate-receipt-template');
await generateReceiptFromTemplate(myData, 'output.pdf');
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸­æ–‡æ˜¾ç¤ºä¸ºæ–¹å—ï¼Ÿ

**åŸå› **ï¼šæœªåŠ è½½ä¸­æ–‡å­—ä½“

**è§£å†³**ï¼šç¡®ä¿ `fonts/` ç›®å½•æœ‰ä¸­æ–‡å­—ä½“æ–‡ä»¶ï¼š
- `NotoSansSC-Regular.ttf`ï¼ˆå·²æœ‰ï¼‰
- æˆ– `SourceHanSansCN-Normal.otf`ï¼ˆå·²ä¸‹è½½ï¼‰

### Q2: æ–‡æœ¬ä½ç½®æ€»æ˜¯å¯¹ä¸å‡†ï¼Ÿ

**åŸå› **ï¼šåæ ‡ç³»ç†è§£é”™è¯¯æˆ–æ¨¡æ¿å°ºå¯¸å˜åŒ–

**è§£å†³**ï¼š
1. ç¡®è®¤ä½¿ç”¨çš„æ˜¯ `imgHeight - è·é¡¶éƒ¨è·ç¦»`
2. é‡æ–°è¿è¡Œ `find-coordinates.js` ç¡®è®¤æ¨¡æ¿å°ºå¯¸
3. ä½¿ç”¨ç½‘æ ¼PDFç²¾ç¡®å®šä½

### Q3: å¦‚ä½•å¤„ç†åŠ¨æ€è¡Œæ•°ï¼ˆå¦‚å¤šæ¡è¡Œç¨‹è®°å½•ï¼‰ï¼Ÿ

**æ–¹æ³•1**ï¼šå¾ªç¯ç»˜åˆ¶
```javascript
data.trips.forEach((trip, index) => {
  const y = firstRowY - (index * rowHeight);
  drawText(trip.date, 40, y);
  drawText(trip.place, 120, y);
});
```

**æ–¹æ³•2**ï¼šé™åˆ¶æœ€å¤§è¡Œæ•°
```javascript
const maxRows = 5;
const displayTrips = data.trips.slice(0, maxRows);
```

### Q4: æ¨¡æ¿éœ€è¦å¤šé¡µæ€ä¹ˆåŠï¼Ÿ

**æ–¹æ³•**ï¼šä¸ºæ¯é¡µåˆ›å»ºç‹¬ç«‹æ¨¡æ¿
```javascript
// ç¬¬1é¡µ
const page1 = pdfDoc.addPage([width, height]);
page1.drawImage(template1, ...);

// ç¬¬2é¡µ
const page2 = pdfDoc.addPage([width, height]);
page2.drawImage(template2, ...);
```

---

## é¡¹ç›®æ–‡ä»¶è¯´æ˜

```
create-and-merge-pdf/
â”œâ”€â”€ template.png                        # æ¨¡æ¿å›¾ç‰‡ï¼ˆä½ æä¾›ï¼‰
â”œâ”€â”€ template-with-grid.pdf              # å¸¦åæ ‡ç½‘æ ¼çš„å‚è€ƒPDFï¼ˆå·¥å…·ç”Ÿæˆï¼‰
â”œâ”€â”€ find-coordinates.js                 # åæ ‡æŸ¥æ‰¾å·¥å…·
â”œâ”€â”€ generate-receipt-template.js        # åŸºäºæ¨¡æ¿çš„PDFç”Ÿæˆå™¨
â”œâ”€â”€ receipt-from-template.pdf           # ç”Ÿæˆçš„PDFç¤ºä¾‹
â”œâ”€â”€ fonts/
â”‚   â”œâ”€â”€ NotoSansSC-Regular.ttf         # ä¸­æ–‡å­—ä½“
â”‚   â””â”€â”€ SourceHanSansCN-Normal.otf     # å¤‡ç”¨ä¸­æ–‡å­—ä½“
â””â”€â”€ TEMPLATE-GUIDE.md                   # æœ¬æ–‡æ¡£
```

---

## ä¸‹ä¸€æ­¥

1. âœ… **å·²å®Œæˆ**ï¼šåŸºäºå›¾ç‰‡æ¨¡æ¿ç”ŸæˆPDF
2. âœ… **å·²å®Œæˆ**ï¼šåæ ‡æŸ¥æ‰¾å·¥å…·
3. ğŸ”² **å¾…ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…template.pngè°ƒæ•´æ‰€æœ‰å­—æ®µåæ ‡
4. ğŸ”² **å¯é€‰**ï¼šé›†æˆåˆ°merge-pdf.jså®ç°ä¸€é”®ç”Ÿæˆå¹¶åˆå¹¶

## ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ¡ˆ1: PDFæ¨¡æ¿ | æ–¹æ¡ˆ2: PDFKitä»£ç  | æ–¹æ¡ˆ3: HTML to PDF |
|------|---------------|-------------------|-------------------|
| æ ·å¼ç²¾ç¡®åº¦ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| å®ç°éš¾åº¦ | â­â­â­ | â­â­â­â­ | â­â­ |
| ç»´æŠ¤æ€§ | â­â­â­â­ | â­â­ | â­â­â­â­ |
| åŠ¨æ€å¸ƒå±€ | â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| æ–‡ä»¶å¤§å° | ä¸­ | å° | å¤§ |

---

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿæ£€æŸ¥ï¼š
1. Node.jsç‰ˆæœ¬ï¼ˆå»ºè®® >= 14ï¼‰
2. ä¾èµ–æ˜¯å¦å®Œæ•´ï¼š`npm install`
3. å­—ä½“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š`ls -l fonts/`
4. æ¨¡æ¿å›¾ç‰‡æ˜¯å¦å­˜åœ¨ï¼š`ls -l template.png`
